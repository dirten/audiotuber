#!/usr/bin/env perl

use strict;
use warnings;

use Getopt::Long;
use File::Which;
use App::AudioTuber qw(/./);

# Read in our command line options
my %params = ();
GetOptions ( \%params,
	"mp3|m=s",      # MP3 file
	"image|i=s",    # image file
	"title|t=s",    # track title
	"artist|a=s",   # artist
	"composer|c=s", # composer
	"ffmpeg|f=s",   # path to ffmpeg
) or die("Error in command line arguments\n");

my $ffmpeg = $params{ffmpeg} // which('ffmpeg');
if (!-x $ffmpeg) {
	print "Could not find ffmpeg executable\n";
	die;
}

if (!$params{mp3}) {
	print "Must provide an MP3 file\n";
	die;
}

if (!-e $params{mp3}) {
	print "MP3 file $params{mp3} does not exist\n";
	die;
}

if ($params{mp3} !~ m/\.mp3$/i) {
	print "MP3 file $params{mp3} is not a valid MP3 file\n";
	die;
}

if (!-e $params{image}) {
        print "Image file $params{image} does not exist\n";
        die;
}

# Get filename without extension

# Read ID3 tags

# Extract embedded cover art, if image not specified

# Generate background image
my $imagefile = &generateImage({title=>$params{title}, artist=>$params{artist}, composer=>$params{composer},});

# Render video
#`$ffmpeg -loop 1 -framerate 2 -i $imagefile -i $mp3 -c:v libx264 -preset medium -tune stillimage -crf 18 -c:a aac -shortest -pix_fmt yuv420p output.mkv`;
